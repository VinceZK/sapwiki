#+PAGEID: 1996014537
#+VERSION: 7
#+STARTUP: align
#+OPTIONS: toc:0
#+TITLE: [[https://wiki.wdf.sap.corp/wiki/pages/viewpage.action?pageId=1996014537][Finance - Journal Posting for InterCompany Reconciliation]]

** Definition
+ Communication Scenario ID: SAP_COM_XXXX
+ Communication Scenario Type: Customer
+ Owner: @Vincent Zhang(I046147)
+ Application Component: FIN-ICR
+ Software Component: SAPSCORE, S4CORE
+ Package: FINS_ICR
+ Scope Dependent: Yes?
+ Customer Guide: 
 
** Description
Large corporations have a lot of inter-company transactions, which should be eliminated from the corporation group level. The problem is that an invoice booked on the Accounts Receivable(AR) at one subsidiary is often not booked on the Accounts Payable(AP) of the payer, on time, correctly, or at all. This gives rise to huge differences which cause problems on the consolidated accounts.

To reconcile the transactions among subsidiaries, one needs to bring all the financial data into a central repository, therefore comes to the idea of Inter-Company Hub(IC Hub in short). IC Hub is built in S/4HANA (both CLOUD & OP), it acts 3 system roles: 
1. InterCompany controller that connects the subsidiaries' accounting systems to make sure AR and AP are correctly and on-time created among the parties involved.
2. Central financial transactions repository that provides matching rules, policies, disputing management, and collaborations.
3. A confident report system that produces group level financial statements. 

SAP Cloud Platform Integration (CPI in short) is introduced in this communication scenario to support end-to-end process integration across cloud-based and on-premise applications (cloud-cloud and cloud-on-premise integration). The leveraged features from SAP CPI are(just name a few important ones):
1. Out-of-the-box connectivity support (IDoc, SFTP, SOAP/HTTPS, SuccessFactors, OData, HTTPS).
2. Message routing to one or more receivers.The platform supports routing that depends on the content of the message (content-based routing). For example, the tenant detects that a message has a particular field value, and forwards it to the specific receiver participant that handles requests from the sender participant.
3. Standard integration contents(iFlow) can be delivered.
4. Message can be persisted in case the connected party is offline. Once the party is online again, the message sending can be resumed?
5. Message ordering.
6. Message monitoring, alert, and audit. (Seems alert is not there?)
7. Security features such as content encryption and certificate-based communication.

The description must include:

*** The IC Hub is in S/4HANA Cloud
#+CAPTION: Integration Architecture on Cloud
[[../image/ICR_IntegrationCloud.png]]
1. Customer create communication arrangement to active the inbound&outbound ICR communication scenarios to connect to the SAP CPI tenant with SOAP.
2. If SAP Identity Provider is mandatory for the authentication between S4HANA tenant and CPI tenant?
3. SAP CPI provide all possible connectors to the external systems, which could be either SAP in different releases or non-SAP systems. 


*** The IC Hub is in S/4HANA OP
#+CAPTION: Integration Architecture on Premise
[[../image/ICR_IntegrationOP.png]]
1. In OP deployment, SAP Cloud Connector is recommended to connect S/4HANA OP instance with an SAP CPI instance. It is also possible to connect CPI directly to the S/4HANA OP, however, the network security and load-balance should be taken care by customers themselves.
2. Same as the S/4HANA Cloud, SAP CPI provides all possible connectors to other external systems.


** System Landscape

#+CAPTION: System Landscape
[[../image/ICR_SysLandscape.png]]

Customer owns the S/4HANA tenant and CPI tenant, as well as all its other accounting systems that need to be connected with the IC Hub. So "owns" means the customer can maintenance iFlow, connections, credentials in the CPI instance, as well as necessary message monitoring.

As for each S/4HANA tenant, it has Q(quality assurance) and P(productive) instances. So for CPI, there must be corresponding instances(sub-accounts) which allows S/4HANA Q to connect with the CPI Q, and S/4HANA P to connect with the CPI P. For other external systems, it is the customer's own responsibility to establish right connections with Q/P system roles. 

*** Questions
1. What's the CPI's license model? Is it licensed as part of an S/4HANA sales order or licensed separately ?
2. Is Eclipse tool mandatory for developing CPI contents? Assume the web tool now is enough?
3. Is there any built-in alert mechanism like send email/short text to assigned responsible people in case message is blocking, system is not available?
4. Is there existing CPI development infrastructure with S/4HANA(ER9), so that SAP application development team can develop and deliver the CPI content along with S/4HANA releases?
5. How the fix is done in case issues/bugs are found during development, and what's the synchronization frequency?
6. How can we synchronize the CPI content releases with the corresponding S/4HANA releases?

** Development Team
| Role          | Name           |
|---------------+----------------|
| Product Owner | Ying, Shi      |
| Architect     | Vincent, Zhang |
| Developer     |                |
| SET Contact   |                |
