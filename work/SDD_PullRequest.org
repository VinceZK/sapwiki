#+PAGEID: 1829146305
#+VERSION: 21
#+STARTUP: align
#+OPTIONS: toc:1
#+TITLE: SDD-Data Submit Request
* Context
A data submit request represents a data submission activity done by local accountants. Usually, there is an underlying data replication step along with the submission activity. In Real-Time Consolidation, the data replication step is eliminated by only recording a timestamp (this typically stands for the financial close time). The timestamp is then used to filter in the data in the universal journal (table ACDOCA) which is before that point. 

#+CAPTION: Data Submit Request
[[../image/DataSubmitRequest.png]]  

The challenge that Real-Time Consolidation faces is that consolidation needs a stable data set, while ACDOCA is time-variant. It is not feasible to stop data entering into ACDOCA, both from a business perspective and a technical perspective, if it is only for the purpose of running consolidation. Of course, data replication can solve this contradiction, but it violates the real-time principle of Real-Time Consolidation. 

The data submit request is designed as a dynamic filtering, or more technically speaking, it is an SQL where-clause that filters source data. Local accountants are allowed to submit multiple requests for each entity in each period, but only the latest one is taken into account as the filter. The data before the latest recorded timestamp is fetched to the consolidation engine. The data after that timestamp is omitted for the consolidation run. However, together with group accountants, local accountants can decide how to deal with delta changes after the latest submit. They can decide either to re-run the consolidation to include it, or to ignore it. 

Data submit requests can be divided to MonthEnd Submit Request and Adjustment Submit Request. MonthEnd Submit Request happens recurrently on every period end. Adjustment Submit Requests are raised in case there are further adjustments after the MonthEnd requests are processed. 

** MonthEnd Submit Request
MonthEnd Submit Requests(MSR) are generated by the end of each consolidation period, either automatically or manually. Once a submit request is created, then the entity can submit its local data for a certain sub-package on the period.

#+CAPTION: MonthEnd Data Submit Request
[[../image/MonthEndPullRequest.png]]  

There are 2 roles involved in the data submission process.  Following tasks are executed in a chronography order:
1. The group accountant opens the period for data submission.
2. The local accountant can now raise the pull requests created by the group accountant. A local validation could happen along with the submission. If validation fails, submission is not allowed unless comments and adjustments are made.
3. The group accountant checks the submitted data and comments. If standardized entries are posted, she may run validation again. Then she decides whether to accept or reject the package.
4. If the data (sub-)package is accepted, then consolidation tasks can be run. The period should be locked for the entity.
5. If the data (sub-)package is rejected, then local accountant is notified to post adjustment documents or provide additional comments. Then he raises a new MonthEnd submit request to encapsulate the changes.

** Adjustment Data Submit Request
Adjustment Submit Requests(ASR) are created in case there are adjustments after consolidation is finished for the period. Unlike MonthEnd submit request, ASR is created by local accountants after the MSR of current period is approved. Another important difference of ASR is that it supports "Defer" operation, which will copy the pointed delta amount to the next period.
 
#+CAPTION: Adjustment Data Submit Request
[[../image/AdjustmentPullRequest.png]]  

1. Local accountant find there is new data entering into ACDOCA for the period which consolidation is already run. He then contact the group accountant for this situation, and request unlock the period to include this new data.
2. The group accountant unlock the period so that local accountant can raise an Adjustment Submit Request. She checks and validates the data, can can do one of the following decisions:
3. Accept the ASR and rerun all the consolidation tasks;
4. Reject the ASR, however the local accountant will raise again with new adjustments.
5. Defer the ASR, the delta amount is copied to the next period. During consolidation for the next period, this amount will be taken into account. 

** Comparison with On-the-Fly consolidation.
The data submit request approach is built on the conclusion that local accountants have the right to decide when and which data should be reported to the group accountants. If no data submit request is raised by local accountants, then the group accountant is not allowed to pull the data from local company, even technically, the data is already in the central system. 

The data submit request is somehow conflict with the on-the-fly consolidation in business duties. As on-the-fly means it always reads the latest data in the central system. Group accountants access the local data without local accountants' permission. _But that doesn't mean data submit request can't co-exist with On-the-Fly_. 

We use data submit request approach to process the legal period end consolidation statements, which requires more on data precise, security, and clear duties. Each period, a consolidated result will be generated. The On-the-Fly consolidation statements always runs on the latest data basis which only extract current period data in ACDOCA, combines with the last periods' consolidated results in ACDOCC, will form a full consolidated picture at anytime.
   
** Overall Data Flow
The overall data flow show how the data is collected and submitted to the consolidation system(BPC).  
#+CAPTION: Data Flow of Data Submission
[[../image/DataFlowOverview.png]]  

1. Data comes from the local finance systems through Central Finance's real-time data replication. Data streams could be validated at document level according to rules defined in the central system, and saved in the central journal table ACDOCA.
2. As not all the subsidiaries are involved in the central finance's landscape, those who can only provide their financial data through spreadsheets submit via "Flexible Upload". The data will first be saved in a staging area before taking into the consolidation system.
3. Only if the local accountant raises a data submit request can the group accountant pull the data from ACDOCA or copy data from staging area to ACDOCC. You can regard a data submit request as a SQL where-clause which can be applied on ACDOCA or ACDOCC to filter the data. As data in ACDOCA is time-vary, so a timestamp is used for filter-in data before it. Thus a snapshot is taken which forms a "Reported Data View".
4. Both local and group accountants can run totals validation on the "Reported Data View". When run totals validation, it also requires the consolidated results from the former periods, as well as the adjustments that posted by group accountants are also in ACDOCC.
5. If the validation is passed, consolidation tasks can be run. Till now, the data handover from the local accountants to the group accountants is finished. If the validation is not passed, adjustments should be done by the local accountant, who needs to re-open the period and post adjustment documents. He should then raise a data submit request again so that the group accountant is notified and run validation on the adjusted data.
6. There are multiple BPC consolidation views created based on ACDOCA and ACDOCC. How many views and how they would be created depends on different use cases. But those views can be generally categorized into 2 categories: 1)Real-time data for preliminary consolidations, 2)Data filtered by submit request for final consolidation. Those views are merged under a composite provider.
7. It is possible for the local accountant to run currency translation in S/4, then it is not necessary to rerun currency translation in BPC again. In this way, BPC only needs to access data in ACDOCC. Because CT in S/4 already saves the translated results in ACDOCC.


* Design
Data submit requests are raised and saved in the central system. Each time, if the local accountant wants to submit his reported financial data, he must raise a data submit request. The group accountant will then be notified, and can use the information in the data submit request to pull data from ACDOCA/C.

** Data Submit Request Table Design
The data submit request table is actually hold filter information that is used to filter in data which is relevant for the consolidation. The mandatory filter dimension is timestamp which is used to point out the lines in ACDOCA. Besides, you can also filter at other dimensions, usually the account dimension, so that you can submit data by packages. 

#+CAPTION: Data Submit Request Table
| Field   | Key | Description                                               |
|---------+-----+-----------------------------------------------------------|
| MANDT   | X   | SAP Client                                                |
| PRUUID  | X   | Data Submit Request UUID                                  |
| MODEL   |     | Consolidation Model                                       |
| DIMEN   |     | Dimension(UC-CS)                                          |
| BCATE   |     | BPC Category(BPC)                                         |
| CONSV   |     | Consolidation Version                                     |
| RVERS   |     | Version for Data Entry(UC-CS)                             |
| PTYPE   |     | Data Submit Request Type: Collective/MonthEnd/Adjustment  |
| FYEAR   |     | Fiscal Year                                               |
| FPERI   |     | Fiscal Period                                             |
| ENTITY  |     | Consolidation Entities: Company, Profit Center            |
| BUNIT   |     | Consolidation Unit(UC-CS)                                 |
| CLTIME  |     | Period Close Timestamp                                    |
| DCMETH  |     | Data Submission Method                                    |
| DENTRY  |     | Data Entry ID                                             |
| USTAT   |     | User Status: Initial/Rejected/Deferred/Submitted/Approved |
| SSTAT   |     | System Status: Ready/Running/Processed/Error              |
| CREATOR |     | Who creates the Data Submit Request                       |
| CTIME   |     | Data Submit Request create time                           |
| UPDATOR |     | Who is the last user update it                            |
| UTIME   |     | The last update time                                      |

1. data submit request is client dependent(=MANDT=).
2. There is a unique ID(=PRUUID=) for each data submit request in UUID format.
3. data submit request is also grouped by consolidation model(=MODEL=) and versions(=CONSV=). In case integrated with BPC, =BCATE= is used to store the BPC category.
4. There are 3 types(=PTYPE=) of data submit request: 1) "Collective" means the data submit request contains sub-packages; 2) "MonthEnd" means a regular mandatory data submit request for each period; 3) "Adjustment" is for adjustment on the MonthEnd data.
5. data submit request is also grouped by fiscal year(=FYEAR=), period(=FPERI=), and entity(=ENTITY=).
6. Each data submit request must have a timestamp(=CLTIME=) assigned which stands for the period close time. And it is that timestamp which is used to filter in lines in ACDOCA who have timestamp value before it.
7. A Data Submission Method must be assigned to a data submit request so that it can maps the data package meta data definition. For data submit requests with type "MonthEnd" and "Adjustment", a data entry ID is also needed, through which it can find a selection which contains additional filter information.
8. User status(=USTAT=) are statuses from user perspective. It is used to control the data submit process and the data visibility. For details please refer ~Data Submit Request Status and Pseudo SQL~. 
9. System status(=SSTAT=) are statuses from system perspective. For example, when a data submit request is approved, the data is ready for consolidation tasks. But if system errors happen during tasks' run, then the system status is set to "Error". And when the tasks are in "Running" status, you cannot submit further requests.
10. Audit information like who(=CREATOR= and =UPDATOR=) and when(=CTIME= and =UTIME=) create it or update it is also attached.
11. =DIMEN=, =RVERS=, and =BUNIT= are only used for UC-CS, which are corresponding to the Model, consolidation version, and consolidation entity.

** Data Submission Method and Data Submit Request 
Data Submission Method is the meta to control how local data is submitted. You can divide the package into sub-packages which can be submitted seperately. Data Submit Requests are generated according to the definition of Data Submission Method. For example, I define a Data Submission Method as following:

#+CAPTION: Method Header
| Model  | Method | Type | Desc.                       | EMode      | VM    |
|--------+--------+------+-----------------------------+------------+-------|
| RTCCTB | DC001  | DS   | Data collection from ACDOCA | Sequential | DV100 |

#+CAPTION: Method Steps
| Model  | Method | Step ID | Desc.            | Seq. | Stream Type | Selection | VM    | Freq. |
|--------+--------+---------+------------------+------+-------------+-----------+-------+-------|
| RTCCTB | DC001  |     001 | AP/AR            |    1 | FI_JOURNAL  | $AP_AR    | DV110 |     1 |
| RTCCTB | DC001  |     002 | Equity&Liability |    3 | FI_JOURNAL  | $EQU_LIAB | DV130 |     1 |
| RTCCTB | DC001  |     003 | Profit&Loss      |    4 | FI_JOURNAL  | $P_L      | DV140 |     1 |
| RTCCTB | DC001  |     004 | Investment       |    5 | INVESTMENT  |           | DV150 |     3 |

All data submission methods are in sequential execution mode, but actually the sequence is not strictly applied during runtime, it only affects the display order in the UI. The method "DC001" has 4 steps with each a data stream type is assigned to indicate the consolidation view. You can also assign a selection to a step to futher boundary the data. From business perspective, each step is corresponding to a data entry that represents a subset of the local data, which is so-called sub-package.

You can assign a validation method to each sub-package, which should only contain rules that apply to the sub-package. You should also assign a validation method on the main package, that is on the method header level. Frequency is assigned to each sub-package to tell on which frequency local accountants should provide the data. The example shows the previous 3 sub-package should be provided every period, the last one should be provided quarterly.

The sub-packages have no tent to cover the complete set of the reported data, nor need to avoid intersections. It is only defined for the reason that you can validate and submit seperately for a subset of the data. You don't have to submit the sub-packages one by one, you can directly provide all the data and submit all together.

Let's try to deduce how local and group accountants play with it.

*** The group accountant opens the current period for data collection
The group accountant can start the data collection for a period, usually, close to the month end. The activity can either be manually or automatically by a recurrence background job. Once opened, a data submit request with type "MonthEnd" is inserted for each entity. Meanwhile, for each required data entry, a "Sub-package" data submit request is also generated.

| PullReq | Model  | BCATE | Type |  Period | Entity | Status  | CLTIME | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+---------+--------+--------+--------|
| 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial |        | DC001  |        |
| 0000002 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial |        | DC001  |    001 |
| 0000003 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial |        | DC001  |    002 |
| 0000004 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial |        | DC001  |    003 |
| 0000005 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial |        | DC001  |    004 |

*** The local accountant submits a sub-package
Once the period is opened, the local accountant can see the package in the data submit cockpit. He now first submits the AP/AR data. The AP/AR data is first validated by validation method "DV110", and then submitted by changing the status of data submit request =0000002= to "Submitted" and record the timestamp to =CLTIME=. 
| PullReq | Model  | BCATE | Type |  Period | Entity | Status    | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+-----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial   |                     | DC001  |        |
| 0000002 | RTCCTB | FINAL | S    | 2016.01 | C100   | Submitted | 2016/01/25 15:20:00 | DC001  |    001 |
| 0000003 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial   |                     | DC001  |    002 |
| 0000004 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial   |                     | DC001  |    003 |
| 0000005 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial   |                     | DC001  |    004 |

*** The group accountant check the validation result
Till now, only AP/AR data is submit. In the BPC's consolidation monitor, the status is changed to "_To be Reviewed_". The group accountant can check the validation result of the AP/AR sub-package. She can also post standardized journal entries and run validation again. Validation in BPC's side can share the same rules with S/4 side. Thus it is not necessary to setup duplicate rules in BPC's control. The group accountant can check the comments/attachments from local accountants' submits, and/or re-run validations if standarized entries are posted. Then she can decide whether to approve or reject the sub-package. 

~The results produced by a validation method can be overwritten with comments/attachments. For example, if rule1 is not passed, then the local accountant can write some comments and it will turn rule1 from red light to green light, so that he can still submit the data.~

If she approves the sub-package, then the data submit request status will be changed to "Approved", otherwise "Rejected". To be in mind, MonthEnd data submit request cannot be deferred. Once a sub-package is approved, it is locked to forbid submit requests on it again. The status in BPC's consolidation monitor will be changed to "_To be Executed_". Then if consolidation tasks are clicked to run, it should run only on the data that are already submitted. =However, currently BPC cannot deal with sub-packages. So, actaully, it will run on all the data before the timestamp of the sub-package.= Although it is not a big deal, as BPC can always re-run tasks, anyway it produces confusion. 

=In 1709, submitting Sub-packages is not supported.=
| PullReq | Model  | BCATE | Type |  Period | Entity | Status   | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |        |
| 0000002 | RTCCTB | FINAL | S    | 2016.01 | C100   | Approved | 2016/01/25 15:20:00 | DC001  |    001 |
| 0000003 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial  |                     | DC001  |    002 |
| 0000004 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial  |                     | DC001  |    003 |
| 0000005 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial  |                     | DC001  |    004 |

**** What happens if a data submit request is rejected?
If the data is not qualified after validation, then she reject it. Once a data submit request is rejected, it cannot be changed again, just left as it is. A new data submit request is created with status "Initial". 
| PullReq | Model  | BCATE | Type |  Period | Entity | Status   | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | C    | 2016.01 | C100   | Initial  |                     | DC001  |        |
| 0000002 | RTCCTB | FINAL | M    | 2016.01 | C100   | Rejected | 2016/01/25 15:20:00 | DC001  |    001 |
| 0000003 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |    002 |
| 0000004 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |    003 |
| 0000005 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |    004 |
| 0000006 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |    001 |

Next time, the local accountant submits data again, the standardized entries posted by the group accountant will also be included. 

*** The local accountant submits the main package
After several round-trips, the local accountant thinks that the whole package is ready to submit. Then he click the submit button on the main package level, which will trigger a validation run firstly on all sub-packages's level, at last on the header level. 

It is not necessary to submit all the sub-packages before submitting the main package. You can just submit the main package without caring about the status of sub-packages. However, when submitting the main package, validation methods on sub-package level will also be invoked. If any error happens, it will block the submitting. 

~For example, if you want sub-package "Investment" should be mandatory, then you define a rule to check the number of rows of the data. If the result is zero, the rule is failed, which will forbid you to submit the main package.~

| PullReq | Model  | BCATE | Type |  Period | Entity | Status    | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+-----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Submitted | 2016/01/28 14:00:05 | DC001  |        |
| 0000002 | RTCCTB | FINAL | S    | 2016.01 | C100   | Approved  | 2016/01/25 15:20:00 | DC001  |    001 |
| 0000003 | RTCCTB | FINAL | S    | 2016.01 | C100   | Rejected  | 2016/01/26 10:11:02 | DC001  |    002 |
| 0000004 | RTCCTB | FINAL | S    | 2016.01 | C100   | Submitted | 2016/01/26 11:30:40 | DC001  |    003 |
| 0000005 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial   | 2016/01/26 11:40:32 | DC001  |    004 |
| 0000006 | RTCCTB | FINAL | S    | 2016.01 | C100   | Initial   | 2016/01/26 15:36:00 | DC001  |    002 |
| 0000007 | RTCCTB | FINAL | A    | 2016.01 | C100   | Approved  | 2016/01/27 09:50:11 | DC001  |    003 |

The Data Submit Cockpit only takes care of the status of main packages, those sub-package statuses don't hinder any processes. 

*** The group accountant decides whether to approve/reject the main package
Now that the whole data is presented to BPC, the group accountant post some standardized entries and/or runs controls. Based on the control results, she decides:

*Option1: Approve it*. She thinks the local data is OK for consolidation, so the collective data submit request is changed to "Approved", then consolidation tasks can run on it. Once approved, the main package is locked. 
 | PullReq | Model  | BCATE | Type |  Period | Entity | Status   | CLTIME              | DCMETH | DENTRY |
 |---------+--------+-------+------+---------+--------+----------+---------------------+--------+--------|
 | 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Approved | 2016/01/28 14:00:05 | DC001  |        |

*Option2: Reject it*. She thinks the local data is not ready for consolidation, so the collective data submit request is changed to "Rejected". Meanwhile, a new MonthEnd request is created automatically and the period is unlocked so that the local accountant can submit again.     
| PullReq | Model  | BCATE | Type |  Period | Entity | Status   | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | M    | 2016.01 | C100   | Rejected | 2016/01/28 14:00:05 | DC001  |        |
| 0000008 | RTCCTB | FINAL | M    | 2016.01 | C100   | Initial  |                     | DC001  |        |
 
The local accountant has to resubmit a new MonthEnd request, as it is mandatory at least one approved MonthEnd request for each period. Before resubmitting, he can view comments that the group accountant provided. Under the advice, he post adjustments and/or provide additional comments, then submit again. 
| PullReq | Model  | BCATE | Type |  Period | Entity | Status    | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+-----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | C    | 2016.01 | C100   | Rejected  | 2016/01/28 14:00:05 | DC001  |        |
| 0000008 | RTCCTB | FINAL | C    | 2016.01 | C100   | Submitted | 2016/01/28 16:08:34 | DC001  |        |

*** The local accountant wants to submit an adjustment request
Although data entry can be locked to forbid further data submits, but it cannot stop data entering into ACDOCA. However, the Data Submit Cockpit can censor if there are new lines entering into ACDOCA after the package is approved. If yes, then the local accountant has to ask for a unlock of the package. To the group accountant, she has to decide whether these new changes should be counted in this consolidation run, or defer to the next period. 

If she chooses to approve the adjustment to this period, then everything is same as the case of rejecting MonthEnd request. Or she chooses to defer this adjustment to the next period, then the table looks like:
| PullReq | Model  | BCATE | Type |  Period | Entity | Status   | CLTIME              | DCMETH | DENTRY |
|---------+--------+-------+------+---------+--------+----------+---------------------+--------+--------|
| 0000001 | RTCCTB | FINAL | C    | 2016.01 | C100   | Rejected | 2016/01/28 14:00:05 | DC001  |        |
| 0000008 | RTCCTB | FINAL | C    | 2016.01 | C100   | Approved | 2016/01/28 16:08:34 | DC001  |        |
| 0000009 | RTCCTB | FINAL | A    | 2016.01 | C100   | Deferred | 2016/01/29 10:23:12 | DC001  |        |

The new request is changed to "Deferred" status, everything keeps same in the data submit request table. But behind, the changed amounts are copied to ACDOCC with the period changed to the next.

*Only adjusment on main pakcage level can be deferred to next period. Sub-package doesn't support defer.* 

When happen if there is another adjustment request submitted after deferring? If the group accountant decides defer again, then still the delta amounts are copied to next period. But if the group accountant wants to counted to the this period, then the former copied amounts must be marked as deleted. 
  
** Data Submit Request Status and Pseudo SQL
The status of data submit requests not only controls the data submit process, but also controls the data visibility by BPC. BPC can only see the data pointed by data submit requests which have status "Submitted" or "Approved". In other words, status code must larger equal than "30". So for those data submit requests with status "Initial" or "Rejected" or "Deferred", BPC won't see the data they point to. 
| User Status | Code |
|-------------+------|
| Initial     |   00 |
| Rejected    |   10 |
| Deferred    |   20 |
| Submitted   |   30 |
| Approved    |   40 |

#+CAPTION: Pseudo SQL that controls visibility
#+BEGIN_SRC sql
-- BPC Result View
  create view V_PULL_REQ_C as 
       select MODEL, BCATE, FYEAR, FPERI, ENTITY, max(CLTIME)
         from RTC_PULL_REQ
        where USTATUS >= 30
     group by MODEL, BCATE, FYEAR, FPERI, ENTITY;

  create view C_RTC_FINAL_VIEWA as
       select * from C_FOUNDATION_VIEW as A
         join V_PULL_REQ_C as B
           on A.RYEAR = B.FYEAR
          and A.POPER = B.FPERI
          and A.RCOMP = B.ENTITY
          and A.TIMESTAMP <= B.CLOSE_TIME
        where B.MODEL = 'RTCCTB'
          and B.BPC_CATG = 'FINAL';

-- Local Validation View for each Validation Method
  create view V_PULL_REQ_MA as 
       select MODEL, BCATE, FYEAR, FPERI, ENTITY, max(CLTIME)
         from RTC_PULL_REQ
        where USTATUS >= 30
     group by MODEL, BCATE, FYEAR, FPERI, ENTITY;

       select * from /RTCART/RTCCTB01 as A
         join I_PULL_REQ_AR as B
           on A.RYEAR = B.FYEAR
          and A.POPER = B.FPERI
          and A.RCOMP = B.ENTITY
          and A.TIMESTAMP <= B.CLTIME
        where B.MODEL = 'RTCCTB'
          and B.BCATE = 'FINAL'
          and B.FYEAR = '2016'
          and B.FPERI = '01'
          and B.ENTITY = 'C100'
          and (<selection_where_string>);                      
#+END_SRC

There is also a business lock table for the group accountant lock certain periods to forbid local accountants raise data submit requests in the periods. The lock table should look like this:
#+CAPTION: Data Submit Request Lock Table
| Field  | Key | Description                                    |
|--------+-----+------------------------------------------------|
| MANDT  | X   | SAP Client                                     |
| MODEL  | X   | Consolidation Model                            |
| VERID  | X   | Consolidation Version ID                       |
| FYEAR  | X   | Group Fiscal Year                              |
| FPERI  | X   | Group Fiscal Period                            |
| ENTITY | X   | Consolidation Entities: Company, Profit Center |
| STATUS |     | Lock Status: 0:Open, 1:Locked                  |
| UUSER  |     | Last Activity User                             |
| UTIME  |     | Last Activity Time                             |
| ETIME  |     | Lock Effective Time                            |

If the corresponding item is not exist in the table, it means the entity in that period is not locked. The lock data is generated the first time a lock is added for an entity and its certain period.


* Data Submit Cockpit
The Data Submit Cockpit is designed for local accountants to collect data, validate data, and submit data for consolidation. However, group accountants can also use it to check, validate, and approve the local reported data.

** Data Submit Cockpit Main Screen
#+CAPTION: Data Submit Cockpit Reported Data
[[../image/DataSubmitCockpit09.png]]

The Data Submit Cockpit is divided into 3 sections: 
1. The permanent parameters in the upper area;
2. The statuses area in the middle area;
3. The package content in the lower area.

*** Permanent Parameters
The five permanent parameters are mandatory, which are used to boundary the context to:
1. A consolidation model(Dimension if it is UC-CS);
2. A consolidation version(BPC Category if it is for BPC);
3. A consolidation Entity(Consolidation Unit if it is UC-CS);
4. A group Fiscal Year;
5. A group Fiscal Period.

The 5 parameters should be filled defaultly whenever possible. The model, version, and entity can be derived from users' authorizations or the psersonlization data. Fiscal year and period can be derived from the current time and fiscal year variant. Only all the 5 parameters' value are provided, can the package status and content be shown. 
 
*** Statuses
A package is the media on which the local accountants and group accountants communicate. Once the local accountant submits his reported data, it gets validated before the data arrives at the group accountant's hand. And the group accountant can also do validations before actually executing consolidation tasks. Thus there are various statuses to state. 

1. *Package Status* indicates the stage of the data submission process;
2. *Control Status* gives the last validation result, whether it is passed or failed;
3. *Lock Status* shows if the current package is locked or not for the data submission;
4. *System Status* returns the execution status from consolidation systems,like "in processing", "failed", "successfully".
5. *Variation* detects if there is new data enterred into ACDOCA/C after the package is approved and run.

There are also 2 timestamps shown to tell users what's the last data submit request's timestamp(if has), and what will be the current data submit request's timestamp if you click the "Submit" button. Click the "Refresh" button will refesh "This Submit Time" to the latest.

*** Package Content
A package contains contents like following:
1. General financial data like FI journals;
2. Additional financial data like investment and inventory data;
3. Control result;
4. Comments and Attachments.

Sometimes, the general financial data and additional financial data can be further divided into sub-packages either because they should be supplied at different time and with different frequency, or because they would be provided by different roles. 

The submit history shows all the round-trips that could happen within a single package. It shows the differences between 2 data submissions. 

You can view the reported data in general balance sheet or income statement format. You can also view them in other formats or reports if you have defined the reporting layouts by your own. The data source mainly comes from ACDOCA and ACDOCC. You can use the standard FI posting APP to post adjustments into ACDOCA, or you change the source by flexible upload adjustments into ACDOCC. By either way you change the reported data, click the "Refresh" button you will see the changes.

The default report contains amounts of prior periods in local currency, you can also run on-the-fly currency translation to get the group currency amount. You can switch the group currency in the right-up corner. "Submitted Amount" means data already submitted in the previous submit requests. "To be Submitted" means the delta amount assigned to current to-be submitted request. The amount is calculated by the total amount minus the "Submitted Amount". 

#+CAPTION: Data Submit Cockpit Flexible Upload
[[../image/DataSubmitCockpit30.png]]

If the "Flexible Upload" button is clicked, the above dialog box will be pop-up to let you upload a CSV file which contains the general financial data. And it will be saved into ACDOCC either by appending or by replacing the existings. You can download the CSV file template to get to know the data schema. 

~The flexible upload for additional financial data should also be provided, which need further investigations.~

In the buttom, there is a tool-bar which contains main operational buttons for a package. The blue buttons are only shown for the group accountants, while the orange ones are only shown for local accountants.

** Data Submit Cockpit Sub-package
A package can be further divided into sub-packages either by different groups of accounts, or by different types of financial data. For example, account payables & account receivables are defined as a sub-package; The investment data can also be defined as a sub-package. All sub-packages together should cover the complete set of the main package, however, intersections among sub-packages are allowed.

#+CAPTION: Data Submit Cockpit Sub-package List
[[../image/DataSubmitCockpit10.png]]

The sub-package structure can be different by periods for a single entity. This is because the frequency of the data requirement is not always the same. For example, investment data may be required quarterly. If for a certain period there is only one sub-package defined, then the "Sub-Packages" tab will not be shown. The only one sub-package should always be the FI data in ACDOCA/C, you just submit/approve it as the representive of the main package.

Besides clicking the name of a sub-package which can navigate you to the detail page of the sub-package, you can also operate directly on the list:
1. Controls: click to run the control directly or open the detail page of the sub-package's control.
2. Package Status: click to pop-up a drop-down list to stitch the status. 
3. System Status: It is used to record the status of whether BPC is running consolidation tasks for the specific cons unit. The system status contains: Ready, Processing, Finished, and Failed. The status is display only. 
4. Variation: Each time a user logins Data Submit Cockpit, it detects whether there is variation till last consolidation run in the same period. Variation means data changes after consolidation is finished for the period. Click the status will navigate you to the detail of the changed data in the "Submit History" tab.

=In the 1709 release, sub-packages can not be submitted, so "Package Status","System Status", and "Variation" are hiden=

#+CAPTION: Data Submit Cockpit Sub-package Detail
[[../image/DataSubmitCockpit20.png]]

The detail page of a sub-package is exactly the same layout as the main package in the exceptions as bellow:
1. A sub-package inheriate lock status from the main package;
2. A sub-package doesn't have the sub-sub-package again, so the "Sub-Packages" tab is never shown;
3. A sub-package has its own controls, own comments, own attachments, and own submit history. The reported data shown here boundaries to the sub-package's data definition. For example, for the AP/AR sub-package, it only shows the amounts of AP/AR accounts. 

=In the 1709 release, sub-packages can not be submitted, so "Package Status","System Status", and "Variation" are hiden=

You can through the breadcrumbs right underneath the permanent parameters area to navigate between the main package and sub-package. This also acts as the package headline to help you not get lost during switching between the main package and its sub-packages.

** Data Submit Cockpit Control
Both main package and its sub-packages have their own controls with the same display layout. 
#+CAPTION: Data Submit Cockpit Controls
[[../image/DataSubmitCockpit11.png]]  

The control page will first show the result of last run if it has. If not, it does an initial run and give out the result which is still not persisted until you click the button "Save Result". 

Each rule result has a traffic light to state it is passed or not. Red light means failed, green light means pass. Yellow means failed but comments are provided which is then exempted. You can run a rule separated by click the icon _Run This Rule_; you can hover over the link _Detail_ to view more detail of the rule result; you can supply or read comments and attachments; and you can drop-down the drill through reports to get further investigations. 

** Data Submit Cockpit Comment
#+CAPTION: Data Submit Cockpit Comments
[[../image/DataSubmitCockpit12.png]]  

In the comment tab, you can view and leave comments. A comment can be made on a (sub-)package, a submit request, or a validation rule result. You can filter to display comments on different levels. 

If you are in the comment tab of the main package, then you can view all the comments which belong to its sub-packages, its submit requests, and its validation logs. User can filter to display. If you are in the comment tab of the sub-package, you can only view comments that belong to its submit requests and validation logs. 
** Data Submit Cockpit Attachments
#+CAPTION: Data Submit Cockpit Attachments
[[../image/DataSubmitCockpit13.png]]  

In the attachment tab, you can upload or download attachments like word, ppt, pdf, and so on. Like comments, attachments can be attached to (sub-)package, submit request, and validation log. 
 
** Data Submit Cockpit Submit History
#+CAPTION: Data Submit Cockpit Submit History 
[[../image/DataSubmitCockpit14.png]]  

In the left panel, you can view all the data submit requests related to the (sub-)package for a certain period. A data submit request is timestamp annotated. You can compare the difference between either 2 requests. In the right panel, from the drop-down box, you select the beginning. For example, you select "Opening", which is the start-point of the period, usually the first second of the period. Then you click any one of the item in the left list, it will show you the difference between the 2 timestamp. 

** Data Submit Group View
#+CAPTION: Data Submit Group View
[[../image/DataSubmitGroupView.png]]  

The group view is a report for group accountants to view the data submit status for multiple entities. They can get an overview on the statuses for a certain group node or a bunch of entities. You can click an entity to navigate to the Data Submit Cockpit, you can batch approve/reject, and you can batch lock/unlock. 

The lock supports lock/unlock in future. Which means, group accountant can schedule to lock/unlock entities for data package submitting. 


* Deduction
The following deduction mainly focus on how data submission integrated with BPC. 

** 1709 With Defer
The data submit method is configured in this way:
#+CAPTION: Method Header
| Model  | Method | Type | Desc.                  | EMode      | VM    |
|--------+--------+------+------------------------+------------+-------|
| RTCCTB | DC002  | DS   | Data Submitting to BPC | Sequential | DV100 |

#+CAPTION: Method Steps
| Model  | Method | Step ID | Desc.     | Seq. | Stream Type | Selection | VM | Freq. |
|--------+--------+---------+-----------+------+-------------+-----------+----+-------|
| RTCCTB | DC002  |     001 | B/L & I/S |    1 | FI_JOURNAL  |           |    |     1 |

The above method is the simplest but most usual case that only contain one sub-package which includes all the data. In this case, there is only the main package, the "sub-package tab" will be hiden. The frequency of the package is by period. Validation method is only given on header level. 
 
=Additional Notes:=
1. We assume local validation is supported in 1709. 
2. Exchange rate between local currency and group currency USD is 1:1.
3. Account number is omitted for simplicity.
4. Irrelevant columns are hided for different steps. 
5. "LC" only reflects BPC's point of view.
6. The corresponding pseudo sql can be found in [[https://wiki.wdf.sap.corp/wiki/x/Ds83bQ][SDD-Consolidation Views]].

*** Scenario 1: CT in BPC, data comes from ACDOCA

*Step 1: Local close*: Data in ACDOCA:  
| Entity |  Period | Amount | Currency | Timestamp           |
|--------+---------+--------+----------+---------------------|
| C100   | 2016.01 |    100 | LC       | 2016/01/29 10:30:00 |

*Step 2: Open period for data collection*: the group accountant opens current period which will generate a MonthEnd request for the entity. The status in initial.
| PullReq | Type | Status  | Entity |  Period | Timestamp |
|---------+------+---------+--------+---------+-----------|
| 0000001 | M    | Initial | C100   | 2016.01 |           |

*Step 3: Submit the report data*: the local accountant submits the report data for current period. The MonthEnd request's status is changed to "Submitted", and the current timestamp is also recorded.  
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Submitted | C100   | 2016.01 | 2016/01/30 10:30:00 |

*Step 4: Approve MonthEnd data submit request*: Once a data submit request is submitted, the group accountant can see the corresponding data in BPC. She can run validation again to confirm the data is OK. The rule could be same as the local accountant's before submit, or she can run additional validation rules. If the result is OK, then the status of the data submit request is changed to "Approved".
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Approved | C100   | 2016.01 | 2016/01/30 10:30:00 |

If the group accountant rejects the data for some reason, then the MonthEnd request is set to "Rejected". And a new MonthEnd request is created automatically with initial status. 
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M    | Initial  | C100   | 2016.01 |                     |

*Step 5: Run consolidation tasks in BPC*: Consolidation results are posted to ACDOCC.
| DOCNR | Type | Entity |    Time | BPC Category | Amount | Currency |
|-------+------+--------+---------+--------------+--------+----------|
| 10001 | M    | C100   | 2016.01 | FINAL        |    100 | USD      |

*Step 6: Post a new adjustment document in ACDOCA*: The period is re-open after consolidation run. 
| Entity |    Time | Amount | Currency | Timestamp           |
|--------+---------+--------+----------+---------------------|
| C100   | 2016.01 |    100 | LC       | 2016/01/29 10:30:00 |
| C100   | 2016.01 |      5 | LC       | 2016/01/30 11:20:00 |

*Step 7: Raise an adjustment data submit request*: Data validation happens on the total data of period 2016.01, rather than the delta data. If passing the validation, a new data submit request is inserted.
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Approved  | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | A    | Submitted | C100   | 2016.01 | 2016/01/30 11:20:00 |

*Step 8: Check the new submitted data:* Here, the group accountant decides whether this delta amount need to be counted into this period, or defer to next period, or just reject it and ask the local accountant submit again. 

If data is validated and approved, she can run consolidation tasks again. BPC re-runs all the consolidation tasks based on the complete data set, rather than only the new submitted delta part. But it posts only delta result to ACDOCC. 
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Approved | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | A    | Approved | C100   | 2016.01 | 2016/01/30 11:20:00 |

| DOCNR | Entity |  Period | BPC Category | Amount | Currency |
|-------+--------+---------+--------------+--------+----------|
| 10001 | C100   | 2016.01 | FINAL        |    100 | USD      |
| 10002 | C100   | 2016.01 | FINAL        |      5 | USD      |

If data is deferred, the data submit request's status is changed to "Deferred". Meanwhile, a new document is posted into ACDOCC which rollup the delta amount and has its period value changes to next period and the currency is still in local. Then, in the next period, the amount will be counted into consolidation. 
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Approved | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | A    | Deferred | C100   | 2016.01 | 2016/01/30 11:20:00 |

| DOCNR | Entity |  Period | BPC Category | Amount | Currency | PullReq |
|-------+--------+---------+--------------+--------+----------+---------|
| 10001 | C100   | 2016.01 | FINAL        |    100 | USD      |         |
| 10002 | C100   | 2016.02 | FINAL        |      5 | LC       | 0000002 |

If data is validated and rejected, the data submit request's status is change to "Rejected" and a new adjustment request is inserted with "Initial" status. Once rejected, BPC won't see the changed data again, it only can see the data which the latest "Submitted" or "Approved" data submit request points. 
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Approved | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | A    | Rejected | C100   | 2016.01 | 2016/01/30 11:20:00 |
| 0000003 | A    | Initial  | C100   | 2016.01 |                     |

*The data submit request id provides following usages:*
1. Flags a valid set of consolidation result lines that belongs to the last approved data submit request.
2. Finds the right timestamp when drilling through to the corresponding source journal items in ACDOCA.

*** Scenario 2: CT in BPC, data comes from ACDOCC
*Step 1: Flexible Upload*: Data is posted into ACDOCC with posting level is null, which allows to change the amounts after posting.  
| DOCNR | PLVL | Entity |  Period | Amount | Currency |
|-------+------+--------+---------+--------+----------|
| 10001 |      | C100   | 2016.01 |    100 | LC       |

*Step 2: Submit Data*: Local accountant submits a data submit request, the uploaded data is copied to a new document with posting level "00".

| PullReq | PTYPE | Status    | Entity |  Period | Timestamp           |
|---------+-------+-----------+--------+---------+---------------------|
| 0000001 | M     | Submitted | C100   | 2016.01 | 2016/01/30 10:30:00 |

| DOCNR | PLVL | Entity |  Period | Amount | Currency | Timestamp           |
|-------+------+--------+---------+--------+----------+---------------------|
| 10001 |      | C100   | 2016.01 |    100 | LC       |                     |
| 20001 |   00 | C100   | 2016.01 |    100 | LC       | 2016/01/30 10:30:00 |

*Step 3: Validate and check the submitted data*: The group accountant can now see the data. She decides to approve or reject it. Because it is a MonthEnd request, she cannot defer it. Now suppose the data is rejected, a new MonthEnd request with "Initial" status is inserted.

| PullReq | PTYPE | Status   | Entity |  Period | Timestamp           |
|---------+-------+----------+--------+---------+---------------------|
| 0000001 | M     | Rejected | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Initial  | C100   | 2016.01 |                     |

*Step 4: Change amount and re-submit*: The local accountant is notified the data is not approved. He changes the amount from 100 to 105, and re-submits a MonthEnd data submit request. Only the delta amount 5 is posted to ACDOCC as a new document. 
| DOCNR | PLVL | Entity |  Period | Amount | Currency | Timestamp           |
|-------+------+--------+---------+--------+----------+---------------------|
| 10001 |      | C100   | 2016.01 |    105 | LC       |                     |
| 20001 |   00 | C100   | 2016.01 |    100 | LC       | 2016/01/30 10:30:00 |
| 20002 |   00 | C100   | 2016.01 |      5 | LC       | 2016/01/30 14:00:00 |

| PullReq | PTYPE | Status    | Entity |  Period | Timestamp           |
|---------+-------+-----------+--------+---------+---------------------|
| 0000001 | M     | Rejected  | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Submitted | C100   | 2016.01 | 2016/01/30 14:00:00 |

*Step 5: Submit an adjustment request and defer*: Now the MonthEnd request is approved, the local accountant wants to submit an adjustment. The group accountant decides to defer this adjustment to next period. 
| PullReq | PTYPE | Status   | Entity |  Period | Timestamp           |
|---------+-------+----------+--------+---------+---------------------|
| 0000001 | M     | Rejected | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Approved | C100   | 2016.01 | 2016/01/30 14:00:00 |
| 0000003 | A     | Deferred | C100   | 2016.01 | 2016/01/31 09:49:13 |

| DOCNR | PLVL | Entity |  Period | Amount | Currency | Timestamp           |
|-------+------+--------+---------+--------+----------+---------------------|
| 10001 |      | C100   | 2016.01 |    115 | LC       |                     |
| 20001 |   00 | C100   | 2016.01 |    100 | LC       | 2016/01/30 10:30:00 |
| 20002 |   00 | C100   | 2016.01 |      5 | LC       | 2016/01/30 14:00:00 |
| 20003 |   00 | C100   | 2016.02 |     10 | LC       | 2016/01/31 09:49:13 |

*** Scenario 3: CT in S4, data comes from ACDOCA
*The delta transaltion must be supported.* 

*Step 1: Local close*: Data is translated and submitted. The timestamp of both consolidation journal entries and the submit reqeust should be the time point when data is read from ACDOCA. 
#+CAPTION: Data in ACDOCA 
| Entity |  Period | Amount | Currency | Timestamp           |
|--------+---------+--------+----------+---------------------|
| C100   | 2016.01 |    100 | LC       | 2016/01/28 20:10:32 |

#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 |

#+CAPTION: Data Submit Request
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Submitted | C100   | 2016.01 | 2016/01/29 10:30:00 |

*Step 2: Approve MonthEnd data submit request*: The group accountant decides to approve or reject the request. If it is approved, only need to change the status of the data submit request. 
#+CAPTION: Data Submit Request
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Approved | C100   | 2016.01 | 2016/01/29 10:30:00 |

If "Rejected", besides changing the status to "Rejected", a new MonthEnd request with "Initial" status is inserted.
#+CAPTION: Data Submit Request
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Initial  | C100   | 2016.01 |                     |

*Step 3: Adjust and re-submit*: In case the MonthEnd request is rejected, the local accountant has to post adjustment documents in ACDOCA, and re-submit the package. However, only delta amount is translated and posted.
#+CAPTION: Data in ACDOCA 
| Entity |  Period | Amount | Currency | Timestamp           |
|--------+---------+--------+----------+---------------------|
| C100   | 2016.01 |    100 | LC       | 2016/01/28 20:10:32 |
| C100   | 2016.01 |      5 | LC       | 2016/01/29 11:10:12 |

#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 |
| C100   | 2016.01 |   05 |         5 | EUR    |         5 | USD    | 2016/01/29 11:27:01 | 0000002 |

#+CAPTION: Data Submit Request
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Rejected  | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Submitted | C100   | 2016.01 | 2016/01/29 11:27:01 |

*Step 4: Submit an adjustment request*: The local accountant find a new amount and wants to submit it as an adjustment. An adjustment data submit request is inserted and a delta CT document is posted.
#+CAPTION: Data in ACDOCA 
| Entity |  Period | Amount | Currency | Timestamp           |
|--------+---------+--------+----------+---------------------|
| C100   | 2016.01 |    100 | LC       | 2016/01/28 20:10:32 |
| C100   | 2016.01 |      5 | LC       | 2016/01/29 11:10:12 |
| C100   | 2016.01 |     10 | LC       | 2016/01/30 09:23:24 |

#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 |
| C100   | 2016.01 |   05 |         5 | EUR    |         5 | USD    | 2016/01/29 11:27:01 | 0000002 |
| C100   | 2016.01 |   05 |        10 | EUR    |        10 | USD    | 2016/01/30 09:39:45 | 0000003 |

#+CAPTION: Data Submit Request
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Rejected  | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved  | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Submitted | C100   | 2016.01 | 2016/01/30 09:39:45 |

*Step 5: Approve/Reject/Defer the adjustment request:* Here, the group accountant can decide whether this delta amount need to be counted into this period, or defer to next period, or just reject it and ask the local accountant submit again. 

If approved, just change the status to "Approved". 
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Approved | C100   | 2016.01 | 2016/01/30 09:39:45 |

If rejected, just change the status to "Rejected"
#+CAPTION: Data Submit Request
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Rejected | C100   | 2016.01 | 2016/01/30 09:39:45 |

If deferred, besides the status is changed to "Deferred", a new document is posted into ACDOCC which rollup the delta amount and has its period value changes to next period and the currency is still in local. Then, in the next period, the amount will be re-translated. 
#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 |
| C100   | 2016.01 |   05 |         5 | EUR    |         5 | USD    | 2016/01/29 11:27:01 | 0000002 |
| C100   | 2016.01 |   05 |        10 | EUR    |        10 | USD    | 2016/01/30 09:39:45 | 0000003 |
| C100   | 2016.02 |   05 |        10 | EUR    |        10 | LC     | 2016/01/30 10:02:31 | 0000003 |

#+CAPTION: Data Submit Request
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Deferred | C100   | 2016.01 | 2016/01/30 09:39:45 |

*Step 6: You want a re-translation due to exchange rate changes:* You click "Reset", all the lines with posting level "05" will be marked as deleted. A new MonthEnd request is inserted with "Initial" status.
#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID | Del |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------+-----|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 | X   |
| C100   | 2016.01 |   05 |         5 | EUR    |         5 | USD    | 2016/01/29 11:27:01 | 0000002 | X   |
| C100   | 2016.01 |   05 |        10 | EUR    |        10 | USD    | 2016/01/30 09:39:45 | 0000003 | X   |
| C100   | 2016.02 |   05 |        10 | EUR    |        10 | LC     | 2016/01/30 10:02:31 | 0000003 | X   |

#+CAPTION: Data Submit Request
| PullReq | Type | Status   | Entity |  Period | Timestamp           |
|---------+------+----------+--------+---------+---------------------|
| 0000001 | M    | Rejected | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Deferred | C100   | 2016.01 | 2016/01/30 09:39:45 |
| 0000004 | M    | Initial  | C100   | 2016.01 |                     |
   
You then submit the MonthEnd request again.
#+CAPTION: Data in ACDOCC 
| Entity |  Period | PLVL | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |  PRUUID | Del |
|--------+---------+------+-----------+--------+-----------+--------+---------------------+---------+-----|
| C100   | 2016.01 |   05 |       100 | EUR    |       100 | USD    | 2016/01/29 10:30:00 | 0000001 | X   |
| C100   | 2016.01 |   05 |         5 | EUR    |         5 | USD    | 2016/01/29 11:27:01 | 0000002 | X   |
| C100   | 2016.01 |   05 |        10 | EUR    |        10 | USD    | 2016/01/30 09:39:45 | 0000003 | X   |
| C100   | 2016.02 |   05 |        10 | EUR    |        10 | LC     | 2016/01/30 10:02:31 | 0000003 | X   |
| C100   | 2016.01 |   05 |       115 | EUR    |       120 | USD    | 2016/01/30 15:13:32 | 0000004 |     |

#+CAPTION: Data Submit Request
| PullReq | Type | Status    | Entity |  Period | Timestamp           |
|---------+------+-----------+--------+---------+---------------------|
| 0000001 | M    | Rejected  | C100   | 2016.01 | 2016/01/29 10:30:00 |
| 0000002 | M    | Approved  | C100   | 2016.01 | 2016/01/29 11:27:01 |
| 0000003 | A    | Deferred  | C100   | 2016.01 | 2016/01/30 09:39:45 |
| 0000004 | M    | Submitted | C100   | 2016.01 | 2016/01/30 15:13:32 |

*** Scenario 4: CT in S4, data comes from ACDOCC
*Step 1: Flexible Upload*: Data is posted into ACDOCC with posting level null, which allows to change the amounts after posting.  
| DOCNR | PLVL | Entity |  Period | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |
|-------+------+--------+---------+-----------+--------+-----------+--------+---------------------|
| 10001 |      | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 09:45:00 |

*Step 2: Submit Data*: Local accountant submits a data submit request. The data is copied into 2 documents, one is with posting level "00" for the local currency amount, another is with posting level "05" for the group currency amount. 
| PullReq | PTYPE | Status    | Entity |  Period | Timestamp           |
|---------+-------+-----------+--------+---------+---------------------|
| 0000001 | M     | Submitted | C100   | 2016.01 | 2016/01/30 10:30:00 |

| DOCNR | PLVL | Entity |  Period | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |
|-------+------+--------+---------+-----------+--------+-----------+--------+---------------------|
| 10001 |      | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 09:45:00 |
| 20001 |   00 | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 10:30:00 |
| 20002 |   05 | C100   | 2016.01 |       100 | EUR    |       100 | USD    | 2016/01/30 10:30:00 |

~In case there are multiple group currencies, then each group currency will get a "05" document.~

*Step 3: Validate and check the submitted data*: The group accountant can now see the data. She decides to approve or reject it. Because it is a MonthEnd request, she cannot defer it. Now suppose the data is rejected, a new MonthEnd request with "Initial" status is inserted.

| PullReq | PTYPE | Status   | Entity |  Period | Timestamp           |
|---------+-------+----------+--------+---------+---------------------|
| 0000001 | M     | Rejected | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Initial  | C100   | 2016.01 |                     |

*Step 4: Change amount and re-submit*: The local accountant changes the amount from 100 to 105, then re-submits the MonthEnd data submit request. Only the delta amount 5 is posted to ACDOCC as a new document. 
| DOCNR | PLVL | Entity |  Period | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |
|-------+------+--------+---------+-----------+--------+-----------+--------+---------------------|
| 10001 |      | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 09:45:00 |
| 20001 |   00 | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 10:30:00 |
| 20002 |   05 | C100   | 2016.01 |       100 | EUR    |       100 | USD    | 2016/01/30 10:30:00 |
| 20003 |   00 | C100   | 2016.01 |         5 | EUR    |         5 | LC     | 2016/01/30 14:00:00 |
| 20004 |   05 | C100   | 2016.01 |         5 | EUR    |         5 | USD    | 2016/01/30 14:00:00 |
 
| PullReq | PTYPE | Status    | Entity |  Period | Timestamp           |
|---------+-------+-----------+--------+---------+---------------------|
| 0000001 | M     | Rejected  | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Submitted | C100   | 2016.01 | 2016/01/30 14:00:00 |

*Step 5: Submit an adjustment request and defer*: Now the MonthEnd request is approved, the local accountant wants to submit an adjustment. The group accountant decides to defer this adjustment to next period. 
| PullReq | PTYPE | Status   | Entity |  Period | Timestamp           |
|---------+-------+----------+--------+---------+---------------------|
| 0000001 | M     | Rejected | C100   | 2016.01 | 2016/01/30 10:30:00 |
| 0000002 | M     | Approved | C100   | 2016.01 | 2016/01/30 14:00:00 |
| 0000003 | A     | Deferred | C100   | 2016.01 | 2016/01/31 09:49:13 |

| DOCNR | PLVL | Entity |  Period | LC Amount | LC Key | GC Amount | GC Key | Timestamp           |
|-------+------+--------+---------+-----------+--------+-----------+--------+---------------------|
| 10001 |      | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 09:45:00 |
| 20001 |   00 | C100   | 2016.01 |       100 | EUR    |       100 | LC     | 2016/01/30 10:30:00 |
| 20002 |   05 | C100   | 2016.01 |       100 | EUR    |       100 | USD    | 2016/01/30 10:30:00 |
| 20003 |   00 | C100   | 2016.01 |         5 | EUR    |         5 | LC     | 2016/01/30 14:00:00 |
| 20004 |   05 | C100   | 2016.01 |         5 | EUR    |         5 | USD    | 2016/01/30 14:00:00 |
| 20005 |   00 | C100   | 2016.02 |        10 | EUR    |        10 | LC     | 2016/01/31 09:49:13 |

** Statuses
*** Before period is open
The period is not open, no MonthEnd request is generated. When Data Submit Cockpit is open for this period, a gentle message will show in the bottom area which tells the user this period is not open for data submission. The "Submit" button is gray out, however, you can still do flexible upload or run CT for some preparation. 
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | Empty                                                        |
| Control                     | Empty                                                        |
| Variation                   | Empty                                                        |
| Lock Status                 | Empty                                                        |
| System Status               | Empty                                                        |
| Last Submit Time            | Empty                                                        |
| This Submit Time            | Empty                                                        |
| Submit Button               | Gray for local accountant, hiden for group accountant        |
| Defer,Reject,Approve Button | Hiden for local accountant, gray for group accountant        |
| Reported Data Tab           | Data in ACDOCA/C of current period, including the deferred amount from the previous period |
| Sub-Packages Tab            | Show sub-package list if avaiable without any interaction allowed |
| Control Tab                 | Not Allowed                                                  |
| Comments Tab                | Not Allowed                                                  |
| Attachments Tab             | Not Allowed                                                  |
| Submit History Tab          | Not Allowed                                                  |

BPC has nothing to do now.  
| BPC Statuses              | State   |
|---------------------------+---------|
| Entity Data Submit Status | Initial |
| Can run BPC Control       | No      |
| Can run Consolidation     | No      |

*** Period is open
The period is open, MonthEnd request is generated with initial status. If the package is locked, you cannot submit the package. If you only run controls and save the control result, then "This timestamp" will be recorded into the pull request. 
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | To be Submitted                                              |
| Control                     | To be Run                                                    |
| Variation                   | Empty                                                        |
| Lock Status                 | Locked/Unlocked                                              |
| System Status               | Empty                                                        |
| Last Submit Time            | Empty                                                        |
| This Submit Time            | Time when the APP is accessed                                |
| Submit Button               | Available for local accountant, hiden for group accountant   |
| Defer,Reject,Approve Button | Hiden for local accountant, gray for group accountant        |
| Reported Data Tab           | Data in ACDOCA/C of current period before this submit time   |
| Sub-Packages Tab            | Show sub-package list if avaiable with any interaction allowed |
| Control Tab                 | There should be no control result save before, but you can run controls. |
| Comments Tab                | Can add comment                                              |
| Attachments Tab             | Can upload attachments                                       |
| Submit History Tab          | Only one pull request with initial status, delta data is shown as the entire data of current period |

BPC has nothing to do now.  
| BPC Statuses              | State   |
|---------------------------+---------|
| Entity Data Submit Status | Initial |
| Can run BPC Control       | No      |
| Can run Consolidation     | No      |

*** Package is submitted
Package will be validated automatically before submitting if "This Submit Time" is different with the timestamp of last control run. If validation is failed, submission is not allowed. 
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | Submitted                                                    |
| Control                     | Passed                                                       |
| Variation                   | If there is new data entering after this submit time         |
| Lock Status                 | UnLocked/Locked                                              |
| System Status               | Empty                                                        |
| Last Submit Time            | The last submit time                                         |
| This Submit Time            | Time after you click the submit button                       |
| Submit Button               | If no variation, then click the button will not raise new request |
| Defer,Reject,Approve Button | Hiden for local accountant, available for group accountant   |
| Reported Data Tab           | Data in ACDOCA/C of current period before this submit time   |
| Sub-Packages Tab            | Show sub-package list if avaiable with any interaction allowed |
| Control Tab                 | Show the control result of last run. Saving result is not allowed |
| Comments Tab                | Can add comment                                              |
| Attachments Tab             | Can upload attachments                                       |
| Submit History Tab          | Available                                                    |

Once the package is submitted, the entity status in BPC's consolidation monitor will be changed to "_To be Viewed_". And the data is actually can be seen by BPC consolidation engine. Clicking "_To be Viewed_" will open the Data Submit Cockpit with the corresponding package.

| BPC Statuses              | State            |
|---------------------------+------------------|
| Entity Data Submit Status | _To be Reviewed_ |
| Can run BPC Control       | Yes              |
| Can run Consolidation     | No               |

*** Package is approved
The group accountant approves the package. After approval, she can run consolidation tasks. The ssystem status will show current status of the data in consolidation engine. Whether it is running, failed, or finished successfully.
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | Approved                                                     |
| Control                     | Passed                                                       |
| Variation                   | If there is new data entering after this submit time         |
| Lock Status                 | UnLocked/Locked                                              |
| System Status               | Empty / Running / Failed / Finished Successfully             |
| Last Submit Time            | The last submit time                                         |
| This Submit Time            | Time when you access this APP                                |
| Submit Button               | If there is variation, then local accountant can click submit to raise an adjustment request. |
| Defer,Reject,Approve Button | Hiden for local accountant, gray for group accountant        |
| Reported Data Tab           | Data in ACDOCA/C of current period before this submit time   |
| Sub-Packages Tab            | Show sub-package list if avaiable. You can view the content of each sub-packages, however, you cannot do any changes on it. |
| Control Tab                 | Show the control result of last run. Saving result is allowed if there is variation. |
| Comments Tab                | Can view comments, or give comments if there is variation    |
| Attachments Tab             | Can download attachments, or upload if there is variation    |
| Submit History Tab          | Available                                                    |

Once the package is approved, the entity status in BPC's consoldiation monitor is changed to "_To be Executed_". You then click to run consolidation tasks. 
| BPC Statuses              | State            |
|---------------------------+------------------|
| Entity Data Submit Status | _To be Executed_ |
| Can run BPC Control       | Yes              |
| Can run Consolidation     | Yes              |

*** Package is rejected
After posting standardized journal entries, she wants to run validation again before approving. However, she thinks the data is not acceptable, so she rejected it with some comments provided to the local accountant. A new request will be created with initial status to allow the local accountant submit again utill get approval.
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | Rejected                                                     |
| Control                     | Passed                                                       |
| Variation                   | If there is new data entering after this submit time         |
| Lock Status                 | UnLocked                                                     |
| System Status               | Empty                                                        |
| Last Submit Time            | The last submit time                                         |
| This Submit Time            | Time when you access this APP                                |
| Submit Button               | If there is variation or any other changes like providing comments, then local accountant can click submit to raise an adjustment request. |
| Defer,Reject,Approve Button | Hiden for local accountant, gray for group accountant        |
| Reported Data Tab           | Data in ACDOCA/C of current period before this submit time   |
| Sub-Packages Tab            | Show sub-package list if avaiable. You can view the content of each sub-packages, however, you cannot do any changes on it. |
| Control Tab                 | Show the control result of last run. Can save control result. |
| Comments Tab                | Can view/reply comments                                      |
| Attachments Tab             | Can download/upload attachments                              |
| Submit History Tab          | Available                                                    |

As the request is not get approved, BPC can still not run consolidation. The status is changed to the former one, that is either "_Initial_" or "_To be Executed_". 
| BPC Statuses              | State                         |
|---------------------------+-------------------------------|
| Entity Data Submit Status | _Initial_ or _To be Executed_ |
| Can run BPC Control       | _Initial_?No:Yes              |
| Can run Consolidation     | _Initial_?No:Yes              |

*** Package is deferred
When we say package is deferred, we only mean some adjustments are deferred. In other words, a MonthEnd request can not be deferred. Only adjustment requests can be deferred.  
|                             | <60>                                                         |
| UI Elements                 | State                                                        |
|-----------------------------+--------------------------------------------------------------|
| Package Status              | Deferred                                                     |
| Control                     | Passed                                                       |
| Variation                   | If there is new data entering after this submit time         |
| Lock Status                 | Locked / Unlocked                                            |
| System Status               | Empty                                                        |
| Last Submit Time            | The last submit time                                         |
| This Submit Time            | Time when you access this APP                                |
| Submit Button               | If there is variation, then local accountant can click submit to raise an adjustment request. |
| Defer,Reject,Approve Button | Hiden for local accountant, gray for group accountant        |
| Reported Data Tab           | Data in ACDOCA/C of current period before this submit time.  |
| Sub-Packages Tab            | Show sub-package list if avaiable. You can view the content of each sub-packages, however, you cannot do any changes on it. |
| Control Tab                 | Show the control result of last run. Can save new control result if there is variation. |
| Comments Tab                | Can comment if there is variation                            |
| Attachments Tab             | Can upload attachments if there is variation                 |
| Submit History Tab          | Available                                                    |

Defer is just like approval, and its previous state should always be "_To be Executed_". Nothing changes for BPC, but only the deferred amount will be copied to next period. 
| BPC Statuses              | State            |
|---------------------------+------------------|
| Entity Data Submit Status | _To be Executed_ |
| Can run BPC Control       | Yes              |
| Can run Consolidation     | Yes              |
 
** 1610 Without Defer
In RTC's first release(1610), data submit request will be used as both a notification and timestamp filtering. The status control in the data submit request will not be fully appeared. BPC can access the data directly in ACDOCA with timestamp filtering. The timestamp in the data submit request which is submitted by the local accountant reflects the local close time. Before the time, the data is allowed(by local accountants) for consolidation, and after the time, the data should not be counted for consolidation. 

This approach has following restrictions:

1. Once the local accountant raise the data submit request, it is approved automatically, and group accountant can only accept it. There is no embedded control on this process, group accountant must notify the local accountant externally if she doesn't want the data. 
2. Delta consolidation is still not possible. Each time the local accountant raise a new data submit request, BPC will always do a full re-consolidation based on the new timestamp. 
3. You can not defer amount to next period.
4. If consolidation is in "RUNNING" or "ERROR" status, reporting will produce data inconsistency.

I give following examples to explain detail data flow:

*** Scenario1: Local accountant submits data through flexible uploading 
*Step 1: Upload data but not submitted*: Data is saved in ACDOCC, a document number is given. The document status in in "Staging". When the user submit the data, he must choose the value of BPC category. The currency key of "CONS_SL" is set to "LC" for easy consumption for BPC. The actual currency key will be saved in HCURK. Currently, there is no data submit request created, so BPC won't see the data.

=ACDOCC=  
| DOCNR | Status  | Entity |    Time | Currency | BPC Category | Group  | FLOW  | CONS_SL | PullReq |
|-------+---------+--------+---------+----------+--------------+--------+-------+---------+---------|
| 10001 | Staging | C100   | 2016.01 | LC       | Actual       | G_NONE | INPUT |     100 |         |

*Step 2: Submit the data*: The original document status is changed to "posted". A data submit request is created and the data submit request number is set in the document lines. Now, BPC can see the data because there is a data submit request exists which will be joined in the BPC consolidation view.

=ACDOCC=
| DOCNR | Status | Entity |   FTime | Currency | BPC Category | Group  | FLOW  | Amount | PullReq |
|-------+--------+--------+---------+----------+--------------+--------+-------+--------+---------|
| 10001 | Posted | C100   | 2016.01 | LC       | Actual       | G_NONE | INPUT |    100 | 0000001 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |

*Step 3: Re-upload a new copy and submit*: The former submitted document will be kept as it is. A new document is  posted along with the data submit requests. Through the consolidation view, BPC will get the data of the latest data submit request for each group of Entity, Fiscal Time, and BPC Category. 
=ACDOCC=
| DOCNR | Status | Entity |   FTime | Currency | BPC Category | Group  | FLOW  | Amount | PullReq |
|-------+--------+--------+---------+----------+--------------+--------+-------+--------+---------|
| 10001 | Posted | C100   | 2016.01 | LC       | Actual       | G_NONE | INPUT |    100 | 0000001 |
| 10002 | Posted | C100   | 2016.01 | LC       | Actual       | G_NONE | INPUT |    110 | 0000002 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |
| 0000002 | C    | C100   | 2016.01 | Actual   | APPROVED |

*** Scenario2: Local accountant submits data in ACDOCA  
If local data is in ACDOCA, then data copy to ACDOCC is unnecessary. Only raise a data submit request with current timestamp is OK. The data submit request is then used to join with the foundation view to get the filtered data before the recored timestamp. 

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category |     CTimestamp | USTATUS  |
|---------+------+--------+---------+----------+----------------+----------|
| 0000001 | A    | C100   | 2016.01 | Actual   | 20160302100020 | APPROVED |

*** Scenario3: Local accountants run currency translation in S/4, data comes from ACDOCA 
Local accountants can run currency translation in S/4 and then do data validations. The translated results will be saved in ACDOCC. BPC cannot see the translated results until he raises a data submit request. In this case, BPC only gets data from ACDOCC rather than ACDOCA.

*Step 1: Local close*: Data in ACDOCA:  
| Entity |    Time | Currency | Amount |
|--------+---------+----------+--------|
| C100   | 2016.01 | LC       |    100 |

*Step 2: Run currency translation*: A rollup runs implicitly to create a local aggregated document. Translated results are also posted with each currency a dedicate document.
=ACDOCC=
| DOCNR | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       |         |
| 10002 | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      |         |
| 10003 | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      |         |
 
*Step 3: Submit the data*: Raise a data submit request
=ACDOCC=
| DOCNR | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       | 0000001 |
| 10002 | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      | 0000001 |
| 10003 | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      | 0000001 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |

*Step 3: Re-submit a new set of translated data*: 
=ACDOCC=
| DOCNR | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       | 0000001 |
| 10002 | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      | 0000001 |
| 10003 | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      | 0000001 |
| 10004 | C100   | 2016.01 | Actual       | 100 | CNY   |     200 | LC       | 0000002 |
| 10005 | C100   | 2016.01 | Actual       | 100 | CNY   |      40 | USD      | 0000002 |
| 10006 | C100   | 2016.01 | Actual       | 100 | CNY   |      36 | EUR      | 0000002 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |
| 0000002 | C    | C100   | 2016.01 | Actual   | APPROVED |

*** Scenario4: Local accountants run currency translation in S/4, data comes from flexible upload 

*Step 1: Upload local data*: Data must be in posted status, or currency translation can not run on it.
=ACDOCC=  
| DOCNR | Status | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       |         |

*Step 2: Run currency translation*: Each currency will generate a document.
=ACDOCC=
| DOCNR | Status | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       |         |
| 10002 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      |         |
| 10003 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      |         |
 
*Step 3: Submit the data*: Raise a data submit request
=ACDOCC=
| DOCNR | Status | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       | 0000001 |
| 10002 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      | 0000001 |
| 10003 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      | 0000001 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |

*Step 4: Re-submit a new set of translated data*: 
=ACDOCC=
| DOCNR | Status | Entity |    Time | BPC Category | HSL | HCURK | CONS_SL | CONS_KEY | PullReq |
|-------+--------+--------+---------+--------------+-----+-------+---------+----------+---------|
| 10001 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |     100 | LC       | 0000001 |
| 10002 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      20 | USD      | 0000001 |
| 10003 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      18 | EUR      | 0000001 |
| 10004 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |     200 | LC       | 0000002 |
| 10005 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      40 | USD      | 0000002 |
| 10006 | Posted | C100   | 2016.01 | Actual       | 100 | CNY   |      36 | EUR      | 0000002 |

=RTC_PULL_REQ=
|    UUID | Type | Entity |   FTime | Category | USTATUS  |
|---------+------+--------+---------+----------+----------|
| 0000001 | C    | C100   | 2016.01 | Actual   | APPROVED |
| 0000002 | C    | C100   | 2016.01 | Actual   | APPROVED |
